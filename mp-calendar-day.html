<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../fa-awesome/fa-awesome.html">
<link rel="import" href="../iron-collapse/iron-collapse.html">

<dom-module id="mp-calendar-day">
    <style>
        :host .pending{
            background: orange;
        }

        :host .assigned{
            background: greenyellow;
        }

        :host .mp-cld-day {
            margin: 0;
            /*padding: 10px;*/
            font-size: 16px;
            border: 1px solid #f7f7f7;
            cursor: pointer;
            z-index: 5;
            transition: all .3s ease-in-out
        }
    </style>
    <template>
        <h4 on-click="_onDayClicked">{{ day }}</h4>
        <iron-collapse id="collapse" opened="[[open]]">
            <template is="dom-repeat" items="[[eventList]]">
                <p class$="[[_getAssigned(item)]]">{{ item.slot }} - {{ item.name }} - {{ item.category }}</p>
            </template>
        </iron-collapse>
    </template>

    <script>
        Polymer({
            is: 'mp-calendar-day',

            properties: {

                // Collapse day
                open: {
                    type: Boolean,
                    value: false
//                    observer: '_onOpen',
//                    reflectToAttribute: true
                },

                // Events list by day
                eventList: {
                    type: Array,
                    value: []
                },

                /**
                 * The current date.
                 */
                date: {
                    type: String,
                    value: function () {
                        return moment().format();
                    },
                    reflectToAttribute: true
                },

                formattedDate: {
                    type: String,
                    computed: '_getFormattedDate(date)'
                },

                year: {
                    type: String,
                    computed: '_getYear(date)'
                },
                day: {
                    type: String,
                    computed: '_getDay(date)'
                },

                disabled: {
                    type: Boolean,
                    value: false,
                    reflectToAttribute: true
                }
            },

            _onOpen: function (newValue, oldValue) {
                console.log(newValue, oldValue);
//                this.$.dayDetails.open = newValue;
            },

            _onDayClicked: function () {
                this.fire('date-selected', {
                    date: this.date
                });
            },

            _getFormattedDate: function (date) {
                date = moment(date);
                return date.format('YYYY-MM-DD');
            },

            _getYear: function (date) {
                date = moment(date);
                return date.format('YYYY');
            },

            _getDay: function (date) {
                date = moment(date);
                return date.format('DD');
            },

            _getAssigned: function (item) {
                if (item.name == '') {
                    return 'pending';
                }
                return 'assigned';
            }
        });
    </script>
</dom-module>
